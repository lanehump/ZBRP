Kits = {
    -- ["pistols"] = {
        ["deagle"] = {
            {item = "WEAPON_PISTOL50", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "50cal_rounds", amount = 150, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["heavypistol"] = {
            {item = "WEAPON_HEAVYPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["sp"] = {
            {item = "WEAPON_SP45", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["combatpistol"] = {
            {item = "WEAPON_COMBATPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 7, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "9mm_rounds", amount = 300, slot = 15},
            {item = "radio", amount = 1, slot = 14},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["pistol50"] = {
            {item = "WEAPON_PISTOL50", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["vintage"] = {
            {item = "WEAPON_VINTAGEPISTOL", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
    -- },
    -- ["ars"] = {
        ["akm"] = {
            {item = "WEAPON_ASSAULTRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "556_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["762"] = {
            {item = "WEAPON_CARBINERIFLE_MK2", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 20, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "556_rounds", amount = 300, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["m16"] = {
            {item = "WEAPON_TACTICALRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "556_rounds", amount = 300, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
        ["heavyrifle"] = {
            {item = "WEAPON_HEAVYRIFLE", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "556_rounds", amount = 300, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
    -- },
    -- ["smgs"] = {
        ["mp5"] = {
            {item = "WEAPON_SMG_MK2", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "repairkit", amount = 1, slot = 10}
        },
    -- },
    -- ["custom"] = {
        ["pumpshotgun"] = {
            {item = "WEAPON_PUMPSHOTGUN", primary = true, amount = 1, slot = 1},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 15, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "shotgun_shells", amount = 50, slot = 15}

        },
        ["mp4v4"] = {
            {item = "WEAPON_HEAVYPISTOL", primary = true, amount = 1, slot = 1},
            {item = "WEAPON_CARBINERIFLE", amount = 1, slot = 4},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "556_rounds", amount = 250, slot = 14},
            {item = "joint", amount = 15, slot = 5},
            {item = "repairkit", amount = 32, slot = 10}
        },
        ["marskman"] = {
            {item = "WEAPON_MARKSMANPISTOL", primary = true, amount = 1, slot = 1},
            {item = "556_rounds", amount = 250, slot = 15},
        },
        ["mcxheavy"] = {
            {item = "WEAPON_HEAVYPISTOL", primary = true, amount = 1, slot = 1},
            {item = "WEAPON_CARBINERIFLE", amount = 1, slot = 4},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
            {item = "radio", amount = 1, slot = 6},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "556_rounds", amount = 250, slot = 14},
            {item = "joint", amount = 15, slot = 5},
            {item = "repairkit", amount = 32, slot = 10}
        },
        ["m60carbmk2"] = {
            {item = "WEAPON_COMBATMG", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 3, slot = 3},
            {item = "stamina", amount = 1, slot = 5},
            {item = "556_rounds", amount = 500, slot = 14},
        },
        ["mayhem-ak-scmk2"] = {
            {item = "WEAPON_ASSAULTRIFLE_MK2", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 3, slot = 3},
            {item = "stamina", amount = 1, slot = 5},
            {item = "556_rounds", amount = 500, slot = 14},
        },
        ["mayhem-kill-leader"] = {
            {item = "WEAPON_COMBATMG_MK2", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 8, slot = 2},
            {item = "medkit", amount = 5, slot = 3},
            {item = "stamina", amount = 3, slot = 5},
            {item = "556_rounds", amount = 750, slot = 14},
        },
        ["m60adv"] = {
            {item = "WEAPON_SPECIALCARBINE", primary = true, amount = 1, slot = 1},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 3, slot = 3},
            {item = "stamina", amount = 1, slot = 5},
            {item = "556_rounds", amount = 500, slot = 14},
        },
    -- },
    -- ["required"] = {
        ["appistol"] = {
            {item = "WEAPON_APPISTOL", primary = true, amount = 1, slot = 1},
            {item = "9mm_rounds", amount = 500, slot = 15},
            {item = "kevlar", amount = 5, slot = 2},
            {item = "medkit", amount = 3, slot = 3},
        },
        ["m1911"] = {
            {item = "WEAPON_M1911", primary = true, amount = 1, slot = 1},
            {item = "9mm_rounds", amount = 250, slot = 15},
            {item = "armour", amount = 5, slot = 2},
            {item = "oxy", amount = 30, slot = 3},
        }
    -- },
}


-- build the 'all' kits automatically 

CreateThread(function()
    Kits["all"] = {} 
    local all = Kits["all"]
    for k,v in pairs(Kits) do 
        for i,p in pairs(Kits[k]) do 
            all[i] = p 
        end
    end
end)
        

function AllKits()
    for k,v in pairs(Kits) do 
        for i,p in pairs(Kits[k]) do 
            API.GiveItem(p.item, p.amount, p.slot)
        end 
    end
end




RegisterNetEvent("inventory:forceKit", function(genre, kit)
    local kit = Kits[genre][kit]
    for k,v in pairs(kit) do API.GiveItem(v.item, v.amount, v.slot) end 
    local primary = API.FindPrimaryWeapon(kit)
    local ammoCount = API.GetKitAmmo(kit)
    GiveWeaponToPed(Player.Ped(), GetHashKey(primary), 0, false, true)
    ApplyWeaponComponents(primary)
    SetPedAmmo(Player.Ped(), GetHashKey(primary), ammoCount)
    Wait(0)
    SetAmmoInClip(Player.Ped(), GetHashKey(primary), 999)
end)

function API.ClearItems()
    TriggerServerEvent("zbrp:Player:clearItems")
end


function DoKitStuff(kit)
    Player.CurrentKit = kit
    API.ClearItems()
    Wait(500)
    API.GiveKit()
end


--[[ WEAPON FUNCTIONS
-- FIND PRIMARY WEAPON (KIT)
-- FIND AMMO COUNT (KIT)
]]

function API.FindPrimaryWeapon(kit)
    local result = "WEAPON_UNARMED"
    for k,v in pairs(kit) do 
        if v.primary then result = v.item end
    end
    return result 
end

function API.GetKitAmmo(kit) 
    local result = 0 
    local primary = API.FindPrimaryWeapon(kit)
    local ammo = findAmmoType(GetHashKey(primary))
    for k,v in pairs(kit) do 
        print(v.item)
        if v.item == ammo then result = result + v.amount end 
    end
    return result
end




function API.GiveKit()
    print("givekit", Player.CurrentKitGenre, Player.CurrentKit )
    -- if Player.CurrentKitGenre == nil or Player.CurrentKit == nil then return end 
    local kit = Kits[Player.CurrentKit]
    for k,v in pairs(kit) do API.GiveItem(v.item, v.amount, v.slot) end 
    local primary = API.FindPrimaryWeapon(kit)
    local ammoCount = API.GetKitAmmo(kit)
    GiveWeaponToPed(Player.Ped(), GetHashKey(primary), 0, false, true)
    ApplyWeaponComponents(primary)
    SetPedAmmo(Player.Ped(), GetHashKey(primary), ammoCount)
    Wait(0)
    SetAmmoInClip(Player.Ped(), GetHashKey(primary), 999)
end
exports("GiveKit", API.GiveKit)

    

-- SWAPPING SLOTS FUNCTIONS 
-- HAS REQUIRED ITEMS FOR KITS 
-- ACTUAL SWAP
-- FIND KEY FROM ITEM NAME

function API.HasRequiredItems(kit)
    for k,v in pairs(kit) do 
        if not API.HasItem(v.item) then return false end 
    end
    return true 
end

function API.FindViaItem(item, kit)
    for k,v in pairs(kit) do 
        if v.item == item then return k end 
    end
    return false 
end



function API.SwapSlots(fromslot, toslot, fromdata, todata)
    local kit = Kits[Player.CurrentKitGenre][Player.CurrentKit]
    if not API.HasRequiredItems(kit) then return end 
    local fromKey = API.FindViaItem(fromdata.item, kit)
    local toKey = API.FindViaItem(todata.item, kit)
    kit[fromKey].slot = toslot
    kit[toKey].slot = fromslot
end


function API.SwapToEmpty(data)
    local kit = Kits[Player.CurrentKitGenre][Player.CurrentKit]
    if not API.HasRequiredItems(kit) then return end 
    local item = API.GetItemInSlot(data.index)
    local key = API.FindViaItem(item, kit)
    if not key then return end 
    kit[key].slot = data.droppedTo 
end


-- EVENTS AND CALLBACKS

-- RegisterNUICallback("nui:zbrp:moveInside", API.SwapToEmpty)
RegisterNetEvent("inventory.api:SwapSlots", API.SwapSlots) -- swap item to item 
RegisterNetEvent("inventory.api:GiveKit", API.GiveKit)
RegisterNetEvent("inventory.api:ClearItems", API.ClearItems)